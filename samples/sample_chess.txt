GAME chess

DEFINE chess:
    PLAYERS (2)
    BOARD (8,8)
    CONDITIONS (ANY)
    RULES (ALL)
    PIECES (pawn, rook, knight, bishop, queen, king)
    OBSTACLES (NONE)
    BOOSTERS (NONE)
END

DEFINE chess.PLAYERS:
    PLAYER player_1 COLOR COLOR.white AT BOARD.ROW.0
    PLAYER player_2 COLOR COLOR.black AT BOARD.ROW.7
    ORDER ([player_1, player_2])
END

DEFINE chess.CONDITIONS:
    CONDITION (ANY, king, count=0)
END

DEFINE chess.RULES:
    RULE promote_rule (white AT BOARD.ROW.7 OR black AT BOARD.ROW.0)
    RULE white_castling (white.king AT BOARD.E0 AND white.rook AT BOARD.H0 AND BOARD.F0.empty() AND BOARD.G0.empty())
    RULE black_castling (black.king AT BOARD.E7 AND black.rook AT BOARD.H7 AND BOARD.F7.empty() AND BOARD.G7.empty())
END

DEFINE chess.PIECES:
    PIECE pawn COUNT 8
    PIECE knight COUNT 2
    PIECE bishop COUNT 2
    PIECE rook COUNT 2
    PIECE queen COUNT 1
    PIECE king COUNT 1

    PIECE pawn ACTION move(forward, 1, 1)
    PIECE pawn ACTION consume(diagonal, 1, 1)
    PIECE pawn ACTION promote(promote_rule, [queen, rook, bishop, knight])

    PIECE rook ACTION move(orthogonal, 8, 8)
    PIECE rook ACTION consume(orthogonal, 8, 8)

    // define knight L move
    move(L_move) = (["NNW", "NNE", "SSW", "SSE", "EEN", "EES", "WWN", "WWS"])
    PIECE knight ACTION move(L_move)
    PIECE knight ACTION consume(L_move)

    PIECE bishop ACTION move(diagonal, 8, 8)
    PIECE bishop ACTION consume(diagonal, 8, 8)

    PIECE queen ACTION move(orthogonal, 8, 8), move(diagonal, 8, 8)
    PIECE queen ACTION consume(orthogonal, 8, 8), move(diagonal, 8, 8)

    PIECE king ACTION move(orthogonal, 1, 1), move(diagonal, 1, 1)
    PIECE king ACTION consume(orthogonal, 1, 1), move(diagonal, 1, 1)


    // define castling as a special move
    move(castle) = (
        white_castling,
        MOVE king FROM BOARD.E0 TO BOARD.G0,
        MOVE rook FROM BOARD.H0 TO BOARD.F0
    ) OR (
        black_castling,
        MOVE king FROM BOARD.E7 TO BOARD.G7,
        MOVE rook FROM BOARD.H7 TO BOARD.F7
    )

    PIECE rook ACTION move(castle_short)
    PIECE king ACTION move(castle_short)

END

DEFINE chess.BOARD:
    PIECE (pawn, white) SETUP (BOARD.A2$ : BOARD.H2$)
    PIECE (rook, white) SETUP (BOARD.A1, BOARD.H1)
    PIECE (knight, white) SETUP (BOARD.B1, BOARD.G1)
    PIECE (bishop, white) SETUP (BOARD.C1, BOARD.F1)
    PIECE (queen, white) SETUP (BOARD.D1)
    PIECE (king, white) SETUP (BOARD.E1)

    PIECE (pawn, black) SETUP (BOARD.A7$ : BOARD.H7$)
    PIECE (rook, black) SETUP (BOARD.A8, BOARD.H8)
    PIECE (knight, black) SETUP (BOARD.B8, BOARD.G8)
    PIECE (bishop, black) SETUP (BOARD.C8, BOARD.F8)
    PIECE (queen, black) SETUP (BOARD.D8)
    PIECE (king, black) SETUP (BOARD.E8)
END

START:
    TURN white
    MOVE pawn TO BOARD.E3
END