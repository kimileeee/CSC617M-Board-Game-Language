GAME chess

DEFINE chess:
    PLAYERS (2)
    BOARD (8,8)
    CONDITIONS (ANY)
    RULES (ALL)
    PIECES (pawn, rook, knight, bishop, queen, king)
    OBSTACLES (NONE)
    BOOSTERS (NONE)
    TIMER(1800)
END

DEFINE chess.PLAYERS:
    PLAYER white COLOR COLOR.white AT BOARD.ROW.0
    PLAYER black COLOR COLOR.black AT BOARD.ROW.7
    ORDER ([white, black])
END

DEFINE chess.CONDITIONS:
    CONDITION (white.king.count() == 0 OR black.king.count() == 0)
END

DEFINE checkers.SCORE:
     SCORE(chess.CONDITIONS)
END

DEFINE chess.RULES:
    RULE promote_rule (white AT BOARD.ROW.7 OR black AT BOARD.ROW.0)
    RULE white_castling ((white.king AT BOARD.E0) AND (white.rook AT BOARD.H0) AND (BOARD.F0.empty()) AND (BOARD.G0.empty()))
    RULE black_castling (black.king AT BOARD.E7 AND black.rook AT BOARD.H7 AND BOARD.F7.empty() AND BOARD.G7.empty())
END

DEFINE chess.PIECES:
    PIECE pawn COUNT 8
    PIECE knight COUNT 2
    PIECE bishop COUNT 2
    PIECE rook COUNT 2
    PIECE queen COUNT 1
    PIECE king COUNT 1

    PIECE pawn ACTION move(forward, 1, 1)
    PIECE pawn ACTION consume(diagonal, 1, 1)
    PIECE pawn ACTION promote(promote_rule, [queen, rook, bishop, knight])

    PIECE rook ACTION move(orthogonal, 8, 8)
    PIECE rook ACTION consume(orthogonal, 8, 8)

    PIECE knight ACTION move(["NNW", "NNE", "SSW", "SSE", "EEN", "EES", "WWN", "WWS"])
    PIECE knight ACTION consume(["NNW", "NNE", "SSW", "SSE", "EEN", "EES", "WWN", "WWS"])

    PIECE bishop ACTION move(diagonal, 8, 8)
    PIECE bishop ACTION consume(diagonal, 8, 8)

    PIECE queen ACTION move(orthogonal, 8, 8), move(diagonal, 8, 8)
    PIECE queen ACTION consume(orthogonal, 8, 8), move(diagonal, 8, 8)

    PIECE king ACTION move(orthogonal, 1, 1), move(diagonal, 1, 1)
    PIECE king ACTION consume(orthogonal, 1, 1), move(diagonal, 1, 1)


    // define castling as a special move
    PIECE move(castle) = (
        white_castling AND
        MOVE king TO BOARD.G0 AND
        MOVE rook TO BOARD.F0
    ) OR (
        black_castling AND
        MOVE king TO BOARD.G7 AND
        MOVE rook TO BOARD.F7
    )

    PIECE rook ACTION move(castle_short)
    PIECE king ACTION move(castle_short)

END

DEFINE chess.BOARD:
    PLAYER white PIECE pawn SETUP (BOARD.A2 ... BOARD.H2)
    PLAYER white PIECE king SETUP (BOARD.A1, BOARD.H1)
    PLAYER white PIECE knight SETUP (BOARD.B1, BOARD.G1)
    PLAYER white PIECE bishop SETUP (BOARD.C1, BOARD.F1)
    PLAYER white PIECE queen SETUP (BOARD.D1)
    PLAYER white PIECE king SETUP (BOARD.E1)

    PLAYER black PIECE pawn SETUP (BOARD.A7 ... BOARD.H7)
    PLAYER black PIECE rook SETUP (BOARD.A8, BOARD.H8)
    PLAYER black PIECE knight SETUP (BOARD.B8, BOARD.G8)
    PLAYER black PIECE bishop SETUP (BOARD.C8, BOARD.F8)
    PLAYER black PIECE queen SETUP (BOARD.D8)
    PLAYER black PIECE king SETUP (BOARD.E8)
END

START:
    TURN white
    MOVE pawn TO BOARD.E3

    a = 6 * 5 + 3 ^ 2
    a = 6 * (5 + 3) ^ 2
END